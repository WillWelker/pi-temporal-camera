//copy the line below to paste this flow inot Node Red using Import > Clipboard

[{"id":"15c2e4a4.8e4c5b","type":"exec","z":"532cf35c.1696ec","command":"sudo modprobe bcm2835-v4l2","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"modprobe bcm2835-v4l2","x":370,"y":160,"wires":[[],[],[]]},{"id":"e646d394.263cb","type":"inject","z":"532cf35c.1696ec","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":"1","x":150,"y":160,"wires":[["15c2e4a4.8e4c5b"]]},{"id":"9014b47f.f63ba8","type":"ui_template","z":"532cf35c.1696ec","group":"1148bf05.e5e2d1","name":"Video Stream","order":3,"width":"8","height":"7","format":"<img name=\"main\" id=\"main\" border=\"0\" width=\"576\" height=\"432\" src=\"http://192.168.43.106:8081\">\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":720,"y":500,"wires":[[]]},{"id":"b495825c.db4a4","type":"inject","z":"532cf35c.1696ec","name":"record start time","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"00 06 * * *","once":false,"onceDelay":"1","x":150,"y":300,"wires":[["4f1af4a3.47d43c"]]},{"id":"4f1af4a3.47d43c","type":"exec","z":"532cf35c.1696ec","command":"rm /home/pi/.node-red/static/seq/*.jpg","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"clear images","x":370,"y":300,"wires":[[],[],[]]},{"id":"42aeffc4.4cab1","type":"ui_template","z":"532cf35c.1696ec","group":"f6c9c42a.29e7e8","name":"show gif","order":1,"width":"8","height":"7","format":"<img src=\"../gif/{{ msg.payload }}.gif\">\n<h3>\n   <a href=\"../gif/{{ msg.payload }}.gif\" download=\"time-shift.gif\">Download This GIF</a>\n</h3>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":700,"y":540,"wires":[[]]},{"id":"24a4e1bd.9d795e","type":"comment","z":"532cf35c.1696ec","name":"For Pi Cameras","info":"These two nodes are only needed if you are\nuding a Raspberry Pi camera.  A USB cam\ndoes not need bcm2835-v4l2.\nMotion is designed to work with USB cameras,\nso the bcm2835-v4l2 makes your Pi camera\nlook like a USB cam to the Motion Program.\nbcm2835-v4l2 needs to be activated at boot time.","x":200,"y":120,"wires":[]},{"id":"c817357.66d5cc8","type":"inject","z":"532cf35c.1696ec","name":"Gif","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":480,"wires":[["4686ab86.337234","2f7afc95.0edfd4"]]},{"id":"4686ab86.337234","type":"exec","z":"532cf35c.1696ec","command":"/home/pi/.node-red/make-gif.sh","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"Make gif","x":320,"y":540,"wires":[["1dfe0f4a.53eee1"],[],[]]},{"id":"2f7afc95.0edfd4","type":"function","z":"532cf35c.1696ec","name":"gif name","func":"var gifName = msg.payload;\nflow.set(\"gifName\",gifName);\nreturn msg;","outputs":1,"noerr":0,"x":320,"y":460,"wires":[[]]},{"id":"1dfe0f4a.53eee1","type":"function","z":"532cf35c.1696ec","name":"name gif","func":"var gifName = flow.get(\"gifName\");\nmsg.payload = gifName;\nreturn msg;","outputs":1,"noerr":0,"x":500,"y":460,"wires":[["42aeffc4.4cab1"]]},{"id":"d2b30238.2c33","type":"comment","z":"532cf35c.1696ec","name":"Set Start Time","info":"Set the inject node to the time you want \nrecording to start.\nThe exec node will run command to clear all\nimages currently stored from motion snapshots.\nFor example 06:00 will clear all images and start\nsaving images from 6 AM","x":150,"y":260,"wires":[]},{"id":"66f8d66c.dd91f8","type":"inject","z":"532cf35c.1696ec","name":"every minute","topic":"","payload":"","payloadType":"date","repeat":"60","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":680,"wires":[["4bff0a06.9ddcf4"]]},{"id":"4bff0a06.9ddcf4","type":"exec","z":"532cf35c.1696ec","command":"/home/pi/.node-red/count-images.sh","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"Count images","x":400,"y":680,"wires":[["eb0b350c.037a48"],[],[]]},{"id":"eb0b350c.037a48","type":"ui_text","z":"532cf35c.1696ec","group":"f6c9c42a.29e7e8","order":2,"width":"0","height":"0","name":"Image Count","label":"Image count for next GIF","format":"{{msg.payload}}","layout":"row-spread","x":680,"y":660,"wires":[]},{"id":"1148bf05.e5e2d1","type":"ui_group","z":"","name":"Live View","tab":"231a2b99.96e194","disp":true,"width":"8","collapse":false},{"id":"f6c9c42a.29e7e8","type":"ui_group","z":"","name":"Time Shift","tab":"231a2b99.96e194","order":2,"disp":true,"width":"8","collapse":false},{"id":"231a2b99.96e194","type":"ui_tab","z":"","name":"Main","icon":"dashboard"}]